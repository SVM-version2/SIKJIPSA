<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- âœ… ë©”íƒ€ SEO -->
    <title>ì‹ë¬¼ ì´ì•¼ê¸° | í…Œë¼ë¦¬ì›€ê³¼ ì‹ì§‘ì‚¬ì˜ ê³µê°„</title>
    <meta name="description" content="ì‹ë¬¼, í…Œë¼ë¦¬ì›€, ì‹ì§‘ì‚¬ ì´ì•¼ê¸°ë¶€í„° ì¸í…Œë¦¬ì–´ íŒê¹Œì§€ í•œëˆˆì—!">
    <meta name="keywords" content="ì‹ë¬¼, í…Œë¼ë¦¬ì›€, ì‹ì§‘ì‚¬, ì¸í…Œë¦¬ì–´í™”ë¶„, í”Œëœí…Œë¦¬ì–´, ì˜¤í›„ì˜ ì‹ë¬¼, ë°˜ë ¤ì‹ë¬¼, ë¯¸ë‹ˆì‹ë¬¼">

    <!-- âœ… OpenGraph (SNS ë¯¸ë¦¬ë³´ê¸°) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="ì‹ë¬¼ ì´ì•¼ê¸° | í…Œë¼ë¦¬ì›€ê³¼ ì‹ì§‘ì‚¬ì˜ ê³µê°„">
    <meta property="og:description" content="í…Œë¼ë¦¬ì›€ê³¼ ì‹ë¬¼ ì¸í…Œë¦¬ì–´ ì•„ì´ë””ì–´, ì‹ì§‘ì‚¬ì˜ ì´ì•¼ê¸°ë¥¼ ë§Œë‚˜ë³´ì„¸ìš”.">
    <meta property="og:image" content="https://plantnoon.com/logo.png">
    <meta property="og:url" content="https://plantnoon.com/story.html">

    <!-- âœ… Twitter ì¹´ë“œ -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ì‹ë¬¼ ì´ì•¼ê¸° | í…Œë¼ë¦¬ì›€ê³¼ ì‹ì§‘ì‚¬ì˜ ê³µê°„">
    <meta name="twitter:description" content="í…Œë¼ë¦¬ì›€ê³¼ ì‹ë¬¼ ì¸í…Œë¦¬ì–´, ì´ˆë¡ ê°ì„±ì„ ì „í•˜ëŠ” ì˜¤í›„ì˜ ì‹ë¬¼">
    <meta name="twitter:image" content="https://plantnoon.com/logo.png">

    <link rel="icon" href="logo.png?v=2" type="image/png">

    <!-- í°íŠ¸ ë° ë„¤ë¹„ê²Œì´ì…˜ CSS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="navigation.css">

 <style>
    /* ì „ì²´ ì½˜í…ì¸ ë¥¼ ê°ì‹¸ëŠ” ë˜í¼ */
.main-wrapper {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 24px;
    max-width: 900px;
    margin: 100px auto 40px;
    padding: 0 16px;
}

.left-sidebar {
    width: 300px;
    position: sticky; /* ìŠ¤í¬ë¡¤í•´ë„ ë”°ë¼ì˜¤ë„ë¡ */
    top: 100px;
    flex-shrink: 0;
}

.story-container {
    max-width: 480px;
    margin: 0; /* ê¸°ì¡´ ë§ˆì§„ ì œê±° */
    width: 100%;
}

/* í€´ì¦ˆ ìœ„ì ¯ ì¹´ë“œ */
.quiz-widget {
    background: #fff;
    border-radius: 18px;
    padding: 24px;
    border: 1px solid #e9e6e6;
    box-shadow: 0 4px 16px rgba(48,60,33,0.07);
}
.quiz-widget h3 {
    margin: 0 0 16px;
    font-family: var(--font-serif);
    color: var(--primary-green);
    font-size: 1.4rem;
    text-align: center;
}
.quiz-widget .question {
    font-size: 1.05rem;
    line-height: 1.6;
    margin: 0 0 20px;
    color: #333;
    font-weight: 500;
}
.quiz-widget .options {
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.quiz-widget .option {
    border: 1.5px solid #ddd;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
    background: #fff;
    text-align: left;
    width: 100%;
}
.quiz-widget .option:hover {
    border-color: var(--primary-green);
    background: #f8fbf6;
}
/* í€´ì¦ˆ ì •ë‹µ/ì˜¤ë‹µ ìŠ¤íƒ€ì¼ */
.quiz-widget .option.correct {
    background-color: #e8f5e9; /* Greenish */
    border-color: #4caf50;
    color: #2e7d32;
    font-weight: bold;
}
.quiz-widget .option.incorrect {
    background-color: #ffebee; /* Reddish */
    border-color: #f44336;
    color: #c62828;
    font-weight: bold;
}
.quiz-widget .option.disabled {
    pointer-events: none;
    opacity: 0.7;
}
.quiz-widget .feedback {
    margin: 18px 0 0;
    font-size: 0.9rem;
    line-height: 1.5;
    color: #444;
    padding: 12px;
    border-radius: 8px;
    background-color: #f5f5f5;
}

/* ë°˜ì‘í˜•: í™”ë©´ì´ ì¢ì•„ì§€ë©´ í€´ì¦ˆ ìœ„ì ¯ì„ í”¼ë“œ ìœ„ë¡œ ì´ë™ */
@media (max-width: 820px) {
    .main-wrapper {
        flex-direction: column;
        align-items: center;
    }
    .left-sidebar {
        position: static;
        width: 100%;
        max-width: 480px;
        margin-bottom: 24px;
    }
}
.story-container {
    max-width: 480px;
    margin: 100px auto 40px;
    padding: 0 8px;
    background: transparent;
}

/* ===== í”Œë¡œíŒ… ë²„íŠ¼ (ê¸€ì“°ê¸°) ===== */
.write-btn {
    position: fixed; right: 26px; bottom: 75px; z-index: 999;
    background: linear-gradient(135deg, #8AD14D 30%, #355F19 100%);
    box-shadow: 0 6px 24px rgba(80,100,70,0.18);
    width: 63px; height: 63px; font-size: 2.6rem; border-radius: 50%;
    color: #fff; border: none;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.21s, box-shadow 0.22s;
}
.write-btn:hover {
    background: linear-gradient(135deg, #355F19 50%, #8AD14D 100%);
    box-shadow: 0 12px 32px rgba(80,100,70,0.25);
    transform: scale(1.07);
}
    /* === ê²Œì‹œë¬¼ í”¼ë“œ ë° ì¹´ë“œ ë””ìì¸ ê°œì„  (ê°€ì¥ ì¤‘ìš”!) === */
    #post-feed {
        display: flex;
        flex-direction: column;
        gap: 24px;
    }
/* ===== ì¸ìŠ¤íƒ€ê·¸ë¨ ìŠ¤íƒ€ì¼ í”¼ë“œ ì¹´ë“œ ===== */
.post-card {
    background: #fff;
    border-radius: 22px;
    margin-bottom: 34px;
    box-shadow: 0 4px 24px rgba(48,60,33,0.10);
    overflow: hidden;
    transition: box-shadow 0.25s, transform 0.23s;
    border: 1.5px solid #e3e6e1;
    position: relative;
}

.post-card:hover {
    box-shadow: 0 8px 32px rgba(48,60,33,0.13);
    transform: translateY(-2px) scale(1.02);
}
/* ===== ì¹´ë“œ ì»¨í…ì¸  ===== */
.post-card-content {
    padding: 24px 22px 22px;
}
 /* ===== ì‘ì„±ì/í”„ë¡œí•„ ===== */
.post-header {
    display: flex;
    align-items: center;
    gap: 11px;
    margin-bottom: 12px;
}
.post-author-avatar {
    width: 38px; height: 38px;
    border-radius: 50%;
    background-color: #A1B793;
    color: #fff; font-weight: bold; font-size: 1.2rem;
    display: flex; justify-content: center; align-items: center;
    border: 2px solid #D4E0C1;
}
.post-author-info {
    display: flex; flex-direction: column;
}
.post-author { font-weight: 700; font-size: 1.02rem; color: #4D5B40;}
.post-date { font-size: 12px; color: #B0B6A9; }
/* ===== ê¸€ ë‚´ìš© ===== */
.post-content {
    font-size: 1.1rem; line-height: 1.6;
    margin: 4px 0 0 0;
    color: #364426;
    word-break: break-word;
}

    /* === ê¸€ì“°ê¸° ëª¨ë‹¬ì°½ ë””ìì¸ ê°œì„  === */
    .story-modal-wrapper {
        position: fixed;
        z-index: 999;
        left: 0; top: 0; width: 100vw; height: 100vh;
        background: rgba(30,30,30,0.45);
        display: flex; justify-content: center; align-items: center;
        opacity: 0; visibility: hidden;
        transition: opacity 0.4s;
        backdrop-filter: blur(3px);
    }
    .story-modal-wrapper.open {
        opacity: 1; visibility: visible;
    }
    .story-modal {
        background: #fff;
        border-radius: 14px;
        padding: 36px 40px;
        width: 90vw;
        max-width: 480px; /* ë„ˆë¹„ ì¡°ì • */
        box-shadow: 0 16px 36px rgba(80,80,80,0.13);
        transform: translateY(50px) scale(0.96);
        opacity: 0;
        transition: all 0.36s cubic-bezier(.52,1.85,.57,.99);
    }
    .story-modal-wrapper.open .story-modal {
        transform: translateY(0) scale(1); opacity: 1;
    }
    .story-modal h2 {
        margin-top: 0;
        text-align: center;
        color: var(--primary-green);
        font-family: var(--font-serif);
        font-size: 1.8rem;
        margin-bottom: 24px;
    }
    .story-modal textarea {
        width: 100%;
        min-height: 120px;
        resize: vertical;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 1rem;
        padding: 14px;
        margin-bottom: 18px;
        font-family: inherit;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    .story-modal textarea:focus {
        outline: none;
        border-color: var(--primary-green);
        box-shadow: 0 0 0 3px rgba(107, 123, 97, 0.2);
    }
    .story-modal .modal-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 6px;
    }
    .story-modal button {
        border: none;
        border-radius: 8px;
        padding: 10px 24px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
    }
    .story-modal button[type="submit"] {
        background: var(--primary-green);
        color: #fff;
    }
    .story-modal button[type="submit"]:hover {
        background: #5a6950;
    }
    /* ì·¨ì†Œ ë²„íŠ¼ì€ ì¤‘ìš”ë„ë¥¼ ë‚®ì¶¤ */
    .story-modal button[type="button"] {
        background: #f0f0f0;
        color: #555;
    }
    .story-modal button[type="button"]:hover {
        background: #e0e0e0;
    }
    /* === ê¸€ì“°ê¸° ëª¨ë‹¬ ë””ìì¸ ê°œì„  (ìˆ˜ì • ë° ì¶”ê°€) === */

/* ëª¨ë‹¬ í—¤ë” (ìƒˆë¡œ ì¶”ê°€) */
.story-modal-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 24px;
    color: var(--primary-green);
}
.story-modal-header svg {
    /* ì•„ì´ì½˜ ìƒ‰ìƒ ë° í¬ê¸° ì¡°ì ˆ */
    stroke: var(--primary-green);
}
.story-modal h2 {
    margin: 0; /* ê¸°ì¡´ ë§ˆì§„ ì œê±° */
    font-size: 1.7rem; /* ì‚´ì§ ì¡°ì • */
}

/* í…ìŠ¤íŠ¸ ì…ë ¥ ì˜ì—­ */
.story-modal textarea {
    min-height: 150px; /* ìµœì†Œ ë†’ì´ ì‚´ì§ ëŠ˜ë¦¬ê¸° */
    margin-bottom: 8px; /* ì¹´ìš´í„°ì™€ì˜ ê°„ê²© ì¡°ì • */
}

/* ê¸€ì ìˆ˜ ì¹´ìš´í„° (ìƒˆë¡œ ì¶”ê°€) */
.char-counter {
    text-align: right;
    font-size: 0.85rem;
    color: #aaa;
    margin-bottom: 18px;
    padding-right: 5px;
}

/* 'ì˜¬ë¦¬ê¸°' ë²„íŠ¼ì— ë¡œë”© ìƒíƒœë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.story-modal button[type="submit"].loading {
    background: #5a6950;
    cursor: wait; /* ì»¤ì„œë¥¼ ëŒ€ê¸° ëª¨ì–‘ìœ¼ë¡œ */
}


/* ===== ê¸°ì¡´ CSS ì½”ë“œ ì•„ë˜ì— ì¶”ê°€ ===== */

/* ===== ê²Œì‹œë¬¼ ì•¡ì…˜ ë²„íŠ¼ (ì¢‹ì•„ìš”, ëŒ“ê¸€) ===== */
.post-actions {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 8px 22px 14px;
    border-top: 1px solid #f0f2ee;
}
.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.95rem;
    color: #555;
    padding: 6px;
    border-radius: 8px;
    transition: background 0.2s, color 0.2s;
}
.action-btn:hover {
    background: #f4f5f4;
}
.action-btn svg {
    width: 22px; height: 22px;
    stroke: #555;
    transition: all 0.2s;
}
/* ì¢‹ì•„ìš” ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ìŠ¤íƒ€ì¼ */
.action-btn.liked svg {
    stroke: #e74c3c;
    fill: #e74c3c;
}
.action-btn.liked {
    color: #e74c3c;
}

/* ===== ëŒ“ê¸€ ì„¹ì…˜ ===== */
/* ===== ëŒ“ê¸€ ì„¹ì…˜ ===== */
.comments-section {
    padding: 0 22px 20px;
    background-color: #fcfcfb;
    border-top: 1px solid #f0f2ee;
}

/* ëŒ“ê¸€ ëª©ë¡ */
.comments-list {
    margin-top: 20px;
    margin-bottom: 20px; /* ì…ë ¥ì°½ê³¼ì˜ ê°„ê²© ì¶”ê°€ */
    display: flex;
    flex-direction: column;
    gap: 14px;
}
.comment {
    display: flex;
    gap: 8px;
    font-size: 0.9rem;
    align-items: flex-start;
}
.comment-author {
    font-weight: bold;
    color: #4D5B40;
    flex-shrink: 0;
}
.comment-text {
    color: #364426;
    word-break: break-word;
    line-height: 1.5;
}
.comment-date {
    font-size: 0.8rem;
    color: #aaa;
    margin-left: auto;
    flex-shrink: 0;
    padding-left: 10px;
}

/* === ëŒ“ê¸€ ì…ë ¥ì°½ ë””ìì¸ ê°œì„  === */
.comment-input-area {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 16px;
}
.comment-user-avatar {
    width: 34px; height: 34px;
    border-radius: 50%;
    background-color: #A1B793;
    color: #fff; font-weight: bold; font-size: 1rem;
    display: flex; justify-content: center; align-items: center;
    flex-shrink: 0;
}
.comment-user-avatar.disabled {
    background-color: #d1d1d1;
}
.comment-input-wrapper {
    flex-grow: 1;
    display: flex;
    align-items: center;
    background: #f0f2ee;
    border: 1px solid #e9e9e9;
    border-radius: 21px; /* ë†’ì´ì˜ ì ˆë°˜ */
    padding: 0 6px 0 16px;
}
.comment-form {
    flex-grow: 1;
    display: flex;
    align-items: center;
}
.comment-form textarea {
    flex-grow: 1;
    border: none;
    background: transparent;
    height: 42px;
    padding: 12px 0;
    resize: none;
    font-size: 0.95rem;
    outline: none;
}
.comment-form button {
    border: none;
    background: transparent;
    cursor: pointer;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s;
    flex-shrink: 0;
}
.comment-form button:hover {
    background: #e0e5da;
}
.comment-form button svg {
    width: 20px;
    height: 20px;
    stroke: #355F19;
}   
#image-preview {
  display: none;
  max-width: 100%;
  max-height: 180px;   /* ğŸ‘ˆ ì¶”ê°€: ëª¨ë‹¬ ë‚´ì—ì„œ ë„ˆë¬´ ì»¤ì§€ì§€ ì•Šë„ë¡ ì œí•œ */
  margin: 10px 0 0 0;
  border-radius: 8px;
  object-fit: contain; /* ğŸ‘ˆ ì¶”ê°€: ì°Œê·¸ëŸ¬ì§€ì§€ ì•Šê²Œ */
  box-shadow: 0 2px 10px rgba(80,100,70,0.07);
}


.image-upload-label {
    display: inline-block;
    padding: 10px 18px;
    background-color: #f0f0f0;
    color: #555;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 0.95rem;
    font-weight: 500;
    margin-top: 10px;
}
.image-upload-label:hover {
    background-color: #e0e0e0;
}

#load-more-btn {
    border: 1.5px solid var(--primary-green);
    background: #fff;
    color: var(--primary-green);
    padding: 10px 28px;
    border-radius: 20px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s;
}
#load-more-btn:hover {
    background: var(--primary-green);
    color: #fff;
}
#load-more-btn.loading {
    cursor: wait;
    opacity: 0.7;
}

/* ê¸°ì¡´ CSS ì–´ë”˜ê°€ì— ì¶”ê°€ */
.post-image {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
}
.post-content {
    /* ... ê¸°ì¡´ ìŠ¤íƒ€ì¼ ... */
    white-space: pre-wrap; /* JSì—ì„œ \nì„ <br>ë¡œ ë°”ê¾¸ëŠ” ì½”ë“œë¥¼ ëŒ€ì²´í•©ë‹ˆë‹¤. */
}
</style>
</head>
<body>

    <header id="main-header">
                       <a href="index.html" class="logo">
            <img src="logo.png" alt="ì˜¤í›„ì˜ ì‹ë¬¼ ë¡œê³ ">
            <span>ì˜¤í›„ì˜ ì‹ë¬¼</span>
        </a>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="story.html">ì´ˆë¡ ì´ì•¼ê¸°</a>
            <a href="myPlant.html">ë‚˜ì˜ ì‹ë¬¼</a>
            <a href="findPlant.html">ì‹ë¬¼ ì°¾ê¸°</a>
            <a href="payment.html">êµ¬ë…í•˜ê¸°</a>
            <a href="#" class="cta-button">Login</a>
        </nav>
    </header>

    <div class="main-wrapper">
        <aside class="left-sidebar">
            <div class="quiz-widget">
                <h3>ğŸŒ¿ ì˜¤ëŠ˜ì˜ í€´ì¦ˆ</h3>
                <p id="quiz-question" class="question">í€´ì¦ˆë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
                <div id="quiz-options" class="options"></div>
                <p id="quiz-feedback" class="feedback" style="display: none;"></p>
            </div>
        </aside>

        <div class="story-container">
            <button class="write-btn" id="open-story-modal" aria-label="ì´ˆë¡ ì´ì•¼ê¸° ê¸€ì“°ê¸°">+</button>
            <div id="post-feed"></div>
            
            <div id="load-more-container" style="text-align: center; padding: 20px;">
                <button id="load-more-btn" style="display: none;">ë” ë¶ˆëŸ¬ì˜¤ê¸°</button>
            </div>
        </div>
    </div>

    <div class="story-modal-wrapper" id="story-modal-wrapper">
        <div class="story-modal">
            <div class="story-modal-header">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>
                <h2>ì´ˆë¡ ì´ì•¼ê¸° ì“°ê¸°</h2>
            </div>
            <form id="story-form">
                <textarea id="story-content" placeholder="ë‹¹ì‹ ì˜ ì´ˆë¡ ì´ì•¼ê¸°ë¥¼ ììœ ë¡­ê²Œ ë‚¨ê²¨ì£¼ì„¸ìš”!" maxlength="2000" required></textarea>
                
                <label for="story-image-input" class="image-upload-label">
                    ğŸ“· ì´ë¯¸ì§€ ì²¨ë¶€í•˜ê¸°
                </label>
                <input type="file" id="story-image-input" accept="image/*" style="display: none;">
                
                <img id="image-preview" src="" style="display:none;max-width:100%;margin:10px 0 0 0;border-radius:8px;" />
                <div id="char-counter" class="char-counter">0 / 2000</div>

                <div class="modal-actions">
                    <button type="button" id="close-story-modal">ì·¨ì†Œ</button>
                    <button type="submit" id="submit-story-btn">ì˜¬ë¦¬ê¸°</button>
                </div>
            </form>
        </div>
    </div>



     <div id="modal-wrapper" class="modal-wrapper">
        <div class="modal">
            <div class="modal-left"></div>
            <div class="modal-right">
                <button class="close-button">&times;</button>
                <!-- Login Form -->
                <div id="login-form" class="form-container">
                    <div class="form-header">
                        <a href="index.html" class="logo">ì˜¤í›„ì˜ ì‹ë¬¼</a>
                        <h2>Welcome Back</h2>
                    </div>
                    <form>
                        <div class="input-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" required>
                        </div>
                        <div class="input-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="cta-button">Login</button>
                    </form>
                    <p class="form-switcher">
                        Don't have an account? <a href="#" id="show-signup">Sign Up</a>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="form-container" style="display: none;">
                    <div class="form-header">
                        <a href="index.html" class="logo">ì˜¤í›„ì˜ ì‹ë¬¼</a>
                        <h2>Create Account</h2>
                    </div>
                    <form>
                        <div class="input-group">
                            <label for="signup-name">Name</label>
                            <input type="text" id="signup-name" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" required>
                        </div>
                        <div class="agreement-group">
    <div class="checkbox-group">
        <input type="checkbox" id="signup-terms" name="terms" required>
        <label for="signup-terms">
            [í•„ìˆ˜] <a href="terms.html" target="_blank">ì´ìš©ì•½ê´€</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
        </label>
    </div>
    <div class="checkbox-group">
        <input type="checkbox" id="signup-privacy" name="privacy" required>
        <label for="signup-privacy">
            [í•„ìˆ˜] <a href="privacy.html" target="_blank">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>ì— ë™ì˜í•©ë‹ˆë‹¤.
        </label>
    </div>
</div>

<button type="submit" class="cta-button">Create Account</button>
                    </form>
                    <p class="form-switcher">
                        Already have an account? <a href="#" id="show-login">Login</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

<nav id="bottom-nav">
  <a href="index.html" class="nav-item">
    <span class="nav-icon">ğŸ </span>
    <span class="nav-label">í™ˆ</span>
  </a>
  <a href="story.html" class="nav-item">
    <span class="nav-icon">ğŸŒ±</span>
    <span class="nav-label">ì´ˆë¡ ì´ì•¼ê¸°</span>
  </a>
  <a href="myPlant.html" class="nav-item">
    <span class="nav-icon">ğŸª´</span>
    <span class="nav-label">ë‚˜ì˜ ì‹ë¬¼</span>
  </a>
  <a href="findPlant.html" class="nav-item">
    <span class="nav-icon">ğŸ’¬</span>
    <span class="nav-label">ì‹ë¬¼ ìƒë‹´ì†Œ</span>
  </a>
    <a href="payment.html" class="nav-item">
    <span class="nav-icon">â­</span>
    <span class="nav-label">êµ¬ë…</span>
  </a>
</nav>
    <script type="module" src="navigation.js"></script>

        <!-- ====== JS: ì´ í˜ì´ì§€ ì „ìš© ìŠ¤í¬ë¦½íŠ¸ ====== -->
    <script type="module">

        console.log("ìŠ¤í† ë¦¬ì§€ ê°ì²´:", storage);
    // === Firebase SDK import(ì´ë¯¸ navigation.jsì—ì„œ í–ˆìœ¼ë‹ˆ import ì¬ì‚¬ìš©) ===
// 1. navigation.jsë¡œë¶€í„° auth, db, storage ë³€ìˆ˜ë¥¼ ì§ì ‘ import í•©ë‹ˆë‹¤.
import { auth, db, storage } from './navigation.js'; 
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
// ìŠ¤í¬ë¦½íŠ¸ ìµœìƒë‹¨ import ë¬¸ì„ ìˆ˜ì •í•˜ì„¸ìš”.
import { 
    collection, addDoc, query, orderBy, serverTimestamp, 
    doc, getDoc, updateDoc, increment, arrayUnion, arrayRemove,
    getDocs, limit, startAfter  // <--- ì´ 3ê°œë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";

// ====== DOM Elements ======
const openBtn = document.getElementById('open-story-modal');
const modalWrapper = document.getElementById('story-modal-wrapper');
const closeBtn = document.getElementById('close-story-modal');
const storyForm = document.getElementById('story-form');
const storyContent = document.getElementById('story-content');
const charCounter = document.getElementById('char-counter');
const submitBtn = document.getElementById('submit-story-btn');
const feed = document.getElementById('post-feed');
const storyImageInput = document.getElementById('story-image-input');
const imagePreview = document.getElementById('image-preview');
const loadMoreBtn = document.getElementById('load-more-btn');

// ====== Pagination State ======
let lastVisible = null; // ë§ˆì§€ë§‰ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ ë¬¸ì„œë¥¼ ì €ì¥
const POSTS_PER_PAGE = 10; // í•œ ë²ˆì— ë¶ˆëŸ¬ì˜¬ ê²Œì‹œë¬¼ ìˆ˜

// ====== User State ======
let currentUser = null;
let currentUserName = "ìµëª…";

// onAuthStateChangedëŠ” ë¡œë“œ ì‹œ í•­ìƒ í•œ ë²ˆ ì‹¤í–‰ë©ë‹ˆë‹¤. (ë¡œê·¸ì¸ ë˜ëŠ” ë¡œê·¸ì•„ì›ƒ ìƒíƒœ)
// ì´ í•¨ìˆ˜ê°€ ì‚¬ìš©ì ìƒíƒœë¥¼ í™•ì¸í•œ í›„, loadStories()ë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ ê°€ì¥ ì•ˆì •ì ì…ë‹ˆë‹¤.
onAuthStateChanged(auth, async (user) => {
    currentUser = user;
    if (user) {
        const userDocRef = doc(db, "users", user.uid);
        const userDoc = await getDoc(userDocRef);
        currentUserName = userDoc.exists() ? userDoc.data().name : "ìµëª…";
    } else {
        currentUserName = "ìµëª…";
    }
    // ì‚¬ìš©ì ì •ë³´ê°€ í™•ì •ëœ í›„ì— ê²Œì‹œë¬¼ ë Œë”ë§ ì‹œì‘
    loadStories(); 
});


// ====== Modal & Form Logic ======
openBtn.addEventListener('click', () => {
    if (!currentUser) {
        document.querySelector('.cta-button').click();
        return;
    }
    storyForm.reset(); 
    charCounter.textContent = "0 / 2000";
    modalWrapper.classList.add('open');
    setTimeout(() => storyContent.focus(), 250);
});
closeBtn.addEventListener('click', () => modalWrapper.classList.remove('open'));
modalWrapper.addEventListener('click', (e) => {
    if (e.target === modalWrapper) modalWrapper.classList.remove('open');
});
storyContent.addEventListener('input', () => {
    charCounter.textContent = `${storyContent.value.length} / 2000`;
});

// ê¸€ ì‘ì„± ì‹œ likesì™€ comments í•„ë“œë¥¼ ë¹ˆ ë°°ì—´ë¡œ ì´ˆê¸°í™”


// ====== Time Formatting Function ======
function timeForToday(value) {
    if (!value) return "";
    // Firestore Timestamp ê°ì²´ì™€ JS Date ê°ì²´ ëª¨ë‘ ì²˜ë¦¬
    const timeValue = value.toDate ? value.toDate() : value;
    const today = new Date();
    const betweenTime = Math.floor((today.getTime() - timeValue.getTime()) / 1000 / 60);

    if (betweenTime < 1) return 'ë°©ê¸ˆ ì „';
    if (betweenTime < 60) return `${betweenTime}ë¶„ ì „`;
    
    const betweenTimeHour = Math.floor(betweenTime / 60);
    if (betweenTimeHour < 24) return `${betweenTimeHour}ì‹œê°„ ì „`;

    const betweenTimeDay = Math.floor(betweenTime / 60 / 24);
    if (betweenTimeDay < 365) return `${betweenTimeDay}ì¼ ì „`;

    return `${Math.floor(betweenTimeDay / 365)}ë…„ ì „`;
}


// ====== Display Stories & Comments ======
// ====== Display Stories & Comments ======
async function loadStories() {
    feed.innerHTML = ""; // í”¼ë“œë¥¼ ë¹„ì›ë‹ˆë‹¤.
    lastVisible = null;  // í˜ì´ì§€ë„¤ì´ì…˜ ìƒíƒœ ì´ˆê¸°í™”
    loadMoreBtn.style.display = 'none'; // ë²„íŠ¼ ìˆ¨ê¸°ê¸°

    const firstBatch = query(
        collection(db, "stories"), 
        orderBy("createdAt", "desc"), 
        limit(POSTS_PER_PAGE)
    );

    const documentSnapshots = await getDocs(firstBatch);

    if (documentSnapshots.empty) {
        feed.innerHTML = `<div style="color:#888;padding:30px;text-align:center;">ì•„ì§ ì‘ì„±ëœ ì´ì•¼ê¸°ê°€ ì—†ì–´ìš”. ì²« ë²ˆì§¸ ì´ì•¼ê¸°ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”!</div>`;
        return;
    }

    // ë§ˆì§€ë§‰ ë¬¸ì„œë¥¼ ì €ì¥
    lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];

    // ê°€ì ¸ì˜¨ ë¬¸ì„œë“¤ì„ í™”ë©´ì— ë Œë”ë§
    documentSnapshots.forEach(doc => {
        renderPost(doc); // ê²Œì‹œë¬¼ í•˜ë‚˜ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜ (ì•„ë˜ì—ì„œ ë§Œë“¦)
    });
    
    // ë¶ˆëŸ¬ì˜¨ ê²Œì‹œë¬¼ ìˆ˜ê°€ í˜ì´ì§€ë‹¹ ê²Œì‹œë¬¼ ìˆ˜ì™€ ê°™ìœ¼ë©´ 'ë” ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ í‘œì‹œ
    if (documentSnapshots.docs.length === POSTS_PER_PAGE) {
        loadMoreBtn.style.display = 'inline-block';
    }
}

function renderPost(doc) {
    const story = doc.data();
    const storyId = doc.id;
    
    const isLiked = currentUser ? story.likes?.includes(currentUser.uid) : false;
    const authorName = story.author || "ìµëª…";
    const dateStr = story.createdAt ? timeForToday(story.createdAt) : "";
    const userInitial = (currentUserName?.charAt(0) || 'P').toUpperCase();
    const isLoggedIn = !!currentUser;

    let imageHtml = '';
    if (story.imageUrl) {
        // ì´ë¯¸ì§€ëŠ” ì¹´ë“œì˜ ë§¨ ìœ„ì— ìœ„ì¹˜í•´ì•¼ radiusê°€ ì˜ˆì˜ê²Œ ì ìš©ë©ë‹ˆë‹¤.
        imageHtml = `<img src="${story.imageUrl}" alt="ìŠ¤í† ë¦¬ ì´ë¯¸ì§€" class="post-image"/>`;
    }

    let commentsHtml = '';
    if (story.comments && story.comments.length > 0) {
        const reversedComments = [...story.comments].reverse();
        reversedComments.forEach(comment => {
            commentsHtml += `
                <div class="comment">
                    <strong class="comment-author">${comment.author}</strong>
                    <span class="comment-text">${comment.text}</span>
                    <span class="comment-date">${timeForToday(comment.createdAt)}</span>
                </div>
            `;
        });
    }

    const card = document.createElement('div');
    card.className = 'post-card';
    card.dataset.postId = storyId;
    card.innerHTML = `
        ${imageHtml}
        <div class="post-card-content">
            <div class="post-header">
                <div class="post-author-avatar">${authorName.charAt(0).toUpperCase()}</div>
                <div class="post-author-info">
                    <span class="post-author">${authorName}</span>
                    <span class="post-date">${dateStr}</span>
                </div>
            </div>
            <p class="post-content">${story.content}</p>
        </div>
        <div class="post-actions">
            <button class="action-btn like-btn ${isLiked ? 'liked' : ''}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>
                <span class="like-count">${story.likesCount || 0}</span>
            </button>
            <button class="action-btn comment-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                <span class="comment-count-text">ëŒ“ê¸€ ${story.comments?.length || 0}</span>
            </button>
        </div>
        <div class="comments-section">
            <div class="comments-list">${commentsHtml}</div>
            <div class="comment-input-area">
                <div class="comment-user-avatar ${isLoggedIn ? '' : 'disabled'}">${isLoggedIn ? userInitial : '?'}</div>
                <div class="comment-input-wrapper">
                    <form class="comment-form">
                        <textarea name="comment" placeholder="${isLoggedIn ? 'ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”...' : 'ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ì„ ë‹¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}" ${isLoggedIn ? '' : 'disabled'} required></textarea>
                        <button type="submit" ${isLoggedIn ? '' : 'disabled'}>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    `;
    feed.appendChild(card);
}

// ====== Event Delegation for Likes and Comments ======
feed.addEventListener('click', async (e) => {
    // --- Like Button Click ---
    const likeBtn = e.target.closest('.like-btn');
    if (likeBtn) {
        if (!currentUser) {
            document.querySelector('.cta-button').click();
            return;
        }
        const card = likeBtn.closest('.post-card');
        const storyId = card.dataset.postId;
        const storyRef = doc(db, "stories", storyId);

        // arrayUnion/arrayRemoveì„ ì‚¬ìš©í•˜ì—¬ ë™ì‹œì„± ë¬¸ì œë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
        if (likeBtn.classList.contains('liked')) {
            // Unlike
            await updateDoc(storyRef, {
                likes: arrayRemove(currentUser.uid),
                likesCount: increment(-1)
            });
        } else {
            // Like
            await updateDoc(storyRef, {
                likes: arrayUnion(currentUser.uid),
                likesCount: increment(1)
            });
        }
    }
    
    // --- Comment Button Click (to focus textarea) ---
    const commentBtn = e.target.closest('.comment-btn');
    if (commentBtn) {
        const card = commentBtn.closest('.post-card');
        card.querySelector('.comment-form textarea').focus();
    }
});

feed.addEventListener('submit', async (e) => {
    // --- Comment Form Submission ---
    if (e.target.classList.contains('comment-form')) {
        e.preventDefault();
        if (!currentUser) {
            alert("ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        const form = e.target;
        const textarea = form.querySelector('textarea');
        const text = textarea.value.trim();
        if (!text) return;

        const card = form.closest('.post-card');
        const storyId = card.dataset.postId;
        const storyRef = doc(db, "stories", storyId);
        
        const newComment = {
            text: text,
            author: currentUserName,
            uid: currentUser.uid,
            createdAt: new Date() 
        };

        // DB ì—…ë°ì´íŠ¸
        await updateDoc(storyRef, {
            comments: arrayUnion(newComment)
        });
        
        // â–¼â–¼â–¼ UI ìˆ˜ë™ ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€ â–¼â–¼â–¼
        const commentsList = card.querySelector('.comments-list');
        const commentCountText = card.querySelector('.comment-count-text');

        // 1. ìƒˆ ëŒ“ê¸€ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
        const newCommentEl = document.createElement('div');
        newCommentEl.className = 'comment';
        newCommentEl.innerHTML = `
            <strong class="comment-author">${newComment.author}</strong>
            <span class="comment-text">${newComment.text}</span>
            <span class="comment-date">ë°©ê¸ˆ ì „</span>`;
        
        // 2. ëª©ë¡ ë§¨ ìœ„ì— ìƒˆ ëŒ“ê¸€ ì¶”ê°€ (ìµœì‹ ìˆœ)
        commentsList.prepend(newCommentEl);

        // 3. ëŒ“ê¸€ ê°œìˆ˜ ì—…ë°ì´íŠ¸
        const newCount = card.querySelectorAll('.comment').length;
        commentCountText.textContent = `ëŒ“ê¸€ ${newCount}`;
        
        // 4. ì…ë ¥ì°½ ì´ˆê¸°í™”
        form.reset();
    }
});

// loadMoreStories í•¨ìˆ˜ ìƒì„±
async function loadMoreStories() {
    if (!lastVisible) { // ë” ì´ìƒ ë¶ˆëŸ¬ì˜¬ ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ì¤‘ë‹¨
        return;
    }

    loadMoreBtn.classList.add('loading');
    loadMoreBtn.disabled = true;

    const nextBatch = query(
        collection(db, "stories"),
        orderBy("createdAt", "desc"),
        startAfter(lastVisible), // ë§ˆì§€ë§‰ìœ¼ë¡œ ë³¸ ë¬¸ì„œ ë‹¤ìŒë¶€í„°
        limit(POSTS_PER_PAGE)
    );

    const documentSnapshots = await getDocs(nextBatch);
    
    if (documentSnapshots.empty) {
        loadMoreBtn.style.display = 'none'; // ë” ì´ìƒ ë¬¸ì„œê°€ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
        return;
    }

    lastVisible = documentSnapshots.docs[documentSnapshots.docs.length - 1];
    
    documentSnapshots.forEach(doc => {
        renderPost(doc);
    });

    if (documentSnapshots.docs.length < POSTS_PER_PAGE) {
        loadMoreBtn.style.display = 'none'; // ë§ˆì§€ë§‰ í˜ì´ì§€ì´ë©´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    }
    
    loadMoreBtn.classList.remove('loading');
    loadMoreBtn.disabled = false;
}

// 'ë” ë¶ˆëŸ¬ì˜¤ê¸°' ë²„íŠ¼ì— í´ë¦­ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
loadMoreBtn.addEventListener('click', loadMoreStories);

// ====== ì˜¤ëŠ˜ì˜ í€´ì¦ˆ ë¡œì§ ======

const quizData = [
    {
        question: "ì‹ë¬¼ì˜ ìì´ ë…¸ë—ê²Œ ë³€í•˜ëŠ” ê°€ì¥ í”í•œ ì›ì¸ì€ ë¬´ì—‡ì¼ê¹Œìš”?",
        options: ["ë¬¼ ë¶€ì¡±", "ê³¼ìŠµ", "í–‡ë¹› ê³¼ë‹¤", "ë³‘ì¶©í•´"],
        correctAnswer: "ê³¼ìŠµ",
        explanation: "ë¿Œë¦¬ê°€ ê³¼ë„í•œ ë¬¼ì— ì ê²¨ ìˆ¨ì„ ì‰¬ì§€ ëª»í•˜ë©´, ììœ¼ë¡œ ê°€ëŠ” ì˜ì–‘ ê³µê¸‰ì´ ì¤‘ë‹¨ë˜ì–´ ìì´ ë…¸ë—ê²Œ ë³€í•˜ê²Œ ë©ë‹ˆë‹¤."
    },
    {
        question: "NASAê°€ ì„ ì •í•œ ê³µê¸°ì •í™”ì‹ë¬¼ 1ìœ„ë¡œ ì•Œë ¤ì§„ ì‹ë¬¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?",
        options: ["ìŠ¤íˆ¬í‚¤", "ì•„ë ˆì¹´ì•¼ì", "ê´€ìŒì£½", "ìŠ¤íŒŒí‹°í•„ë£¸"],
        correctAnswer: "ì•„ë ˆì¹´ì•¼ì",
        explanation: "ì•„ë ˆì¹´ì•¼ìëŠ” í¬ë¦„ì•Œë°íˆë“œì™€ ê°™ì€ ìœ í•´ë¬¼ì§ˆ ì œê±° ëŠ¥ë ¥ì´ ë›°ì–´ë‚˜ê³ , ê°€ìŠµ íš¨ê³¼ë„ ìˆì–´ ì‹¤ë‚´ ì‹ë¬¼ë¡œ ì¸ê¸°ê°€ ë§ìŠµë‹ˆë‹¤."
    },
    {
        question: "ì‹ë¬¼ì˜ 'ê´‘í•©ì„±'ì— ê¼­ í•„ìš”í•œ 3ê°€ì§€ ìš”ì†Œê°€ ì•„ë‹Œ ê²ƒì€ ë¬´ì—‡ì¼ê¹Œìš”?",
        options: ["í–‡ë¹›", "ë¬¼", "ì‚°ì†Œ", "ì´ì‚°í™”íƒ„ì†Œ"],
        correctAnswer: "ì‚°ì†Œ",
        explanation: "ê´‘í•©ì„±ì€ í–‡ë¹›, ë¬¼, ì´ì‚°í™”íƒ„ì†Œë¥¼ ì´ìš©í•´ í¬ë„ë‹¹(ì–‘ë¶„)ê³¼ 'ì‚°ì†Œ'ë¥¼ ë§Œë“¤ì–´ë‚´ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ì‚°ì†ŒëŠ” ê²°ê³¼ë¬¼ì´ì§€, í•„ìš” ìš”ì†ŒëŠ” ì•„ë‹ˆì—ìš”."
    },
    {
        question: "ì‹ë¬¼ì˜ ì¤„ê¸°ë‚˜ ìì„ ì˜ë¼ ìƒˆë¡œìš´ ê°œì²´ë¥¼ ë§Œë“œëŠ” ë²ˆì‹ ë°©ë²•ì„ ë¬´ì—‡ì´ë¼ê³  í• ê¹Œìš”?",
        options: ["íŒŒì¢…", "ë¶„ê°ˆì´", "êº¾ê½‚ì´(ì‚½ëª©)", "ë¬¼ê½‚ì´"],
        correctAnswer: "êº¾ê½‚ì´(ì‚½ëª©)",
        explanation: "êº¾ê½‚ì´(ì‚½ëª©)ëŠ” ì‹ë¬¼ì˜ ì˜ì–‘ìƒì‹ ë°©ë²• ì¤‘ í•˜ë‚˜ë¡œ, ë¶€ëª¨ ì‹ë¬¼ê³¼ ë™ì¼í•œ ìœ ì „ìë¥¼ ê°€ì§„ ìƒˆë¡œìš´ ì‹ë¬¼ì„ ì‰½ê²Œ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    },
    {
        question: "ë‹¤ìœ¡ì‹ë¬¼ì— ë¬¼ì„ ë„ˆë¬´ ìì£¼ ì£¼ë©´ ì•ˆ ë˜ëŠ” ì£¼ëœ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
        options: ["ìì´ ë„ˆë¬´ ì»¤ì ¸ì„œ", "ë¿Œë¦¬ê°€ ì©ê¸° ì‰¬ì›Œì„œ", "ìƒ‰ì´ ì˜…ì–´ì ¸ì„œ", "ê°€ì‹œê°€ ë¬´ëŒì ¸ì„œ"],
        correctAnswer: "ë¿Œë¦¬ê°€ ì©ê¸° ì‰¬ì›Œì„œ",
        explanation: "ë‹¤ìœ¡ì‹ë¬¼ì€ ê±´ì¡°í•œ í™˜ê²½ì— ì ì‘í•˜ì—¬ ìì— ë¬¼ì„ ì €ì¥í•©ë‹ˆë‹¤. ë¬¼ì„ ë„ˆë¬´ ìì£¼ ì£¼ë©´ ë¿Œë¦¬ê°€ ê³„ì† ì –ì–´ìˆì–´ ì©ê¸° ì‰½ìŠµë‹ˆë‹¤."
    },
    {
        question: "ëª¬ìŠ¤í…Œë¼ ìì— êµ¬ë©ì´ ëš«ë ¤ìˆëŠ” ìì—°ì ì¸ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œìš”?",
        options: ["ë²Œë ˆê°€ íŒŒë¨¹ì–´ì„œ", "ìŠ¤ìŠ¤ë¡œ ë¬´ê²Œë¥¼ ì¤„ì´ê¸° ìœ„í•´", "ì•„ë˜ìª½ ìê¹Œì§€ ë¹›ì„ ë³´ë‚´ê¸° ìœ„í•´", "ë¬¼ì„ ë” ì˜ í¡ìˆ˜í•˜ê¸° ìœ„í•´"],
        correctAnswer: "ì•„ë˜ìª½ ìê¹Œì§€ ë¹›ì„ ë³´ë‚´ê¸° ìœ„í•´",
        explanation: "ëª¬ìŠ¤í…Œë¼ëŠ” í° ìì„ ê°€ì§„ ë©êµ´ì„± ì‹ë¬¼ì…ë‹ˆë‹¤. ìì— êµ¬ë©ì´ ìˆìœ¼ë©´ ìœ„ìª½ ìì´ ì•„ë˜ìª½ ìì˜ í–‡ë¹›ì„ ê°€ë¦¬ëŠ” ê²ƒì„ ìµœì†Œí™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    },
    {
        question: "ë°˜ë ¤ë™ë¬¼ì—ê²Œ ë…ì„±ì´ ìˆì–´ í‚¤ìš¸ ë•Œ ì£¼ì˜í•´ì•¼ í•˜ëŠ” ì‹ë¬¼ì´ ì•„ë‹Œ ê²ƒì€?",
        options: ["ë°±í•©", "ì•„ì´ë¹„", "ì•Œë¡œì— ë² ë¼", "ìº£ë‹¢"],
        correctAnswer: "ìº£ë‹¢",
        explanation: "ë°±í•©, ì•„ì´ë¹„, ì•Œë¡œì— ë² ë¼ëŠ” ë°˜ë ¤ë™ë¬¼ì—ê²Œ ì¤‘ë… ì¦ìƒì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì–´ ì£¼ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤. ìº£ë‹¢ì€ ê³ ì–‘ì´ì—ê²Œ ì•ˆì „í•˜ê³  ì˜¤íˆë ¤ ì¦ê±°ì›€ì„ ì¤ë‹ˆë‹¤."
    }
];

function displayDailyQuiz() {
    const today = new Date();
    // ê¸°ì¤€ì¼ë¡œë¶€í„° ë©°ì¹ ì´ ì§€ë‚¬ëŠ”ì§€ ê³„ì‚°í•˜ì—¬ ë§¤ì¼ ë‹¤ë¥¸ í€´ì¦ˆê°€ ë‚˜ì˜¤ë„ë¡ ìˆ˜ì •
    const startDate = new Date('2025-01-01');
    const diffTime = Math.abs(today - startDate);
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 
    const quizIndex = diffDays % quizData.length;
    const dailyQuiz = quizData[quizIndex];
    
    const questionEl = document.getElementById('quiz-question');
    const optionsEl = document.getElementById('quiz-options');
    const feedbackEl = document.getElementById('quiz-feedback');

    questionEl.textContent = dailyQuiz.question;
    optionsEl.innerHTML = ""; // ì´ì „ ì˜µì…˜ ì´ˆê¸°í™”
    feedbackEl.style.display = 'none';

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì˜¤ëŠ˜ í€´ì¦ˆë¥¼ í’€ì—ˆëŠ”ì§€ í™•ì¸
    const lastQuizDate = localStorage.getItem('lastQuizDate');
    const hasAnsweredToday = lastQuizDate === today.toDateString();

    dailyQuiz.options.forEach(optionText => {
        const optionBtn = document.createElement('button');
        optionBtn.className = 'option';
        optionBtn.textContent = optionText;
        optionsEl.appendChild(optionBtn);

        if (hasAnsweredToday) {
            showResult(optionBtn, dailyQuiz, feedbackEl);
        } else {
             optionBtn.addEventListener('click', () => handleOptionClick(optionBtn, dailyQuiz));
        }
    });
}

function handleOptionClick(selectedBtn, quiz) {
     const today = new Date();
     localStorage.setItem('lastQuizDate', today.toDateString()); // ì˜¤ëŠ˜ ë‚ ì§œë¡œ ê¸°ë¡

    const optionsContainer = document.getElementById('quiz-options');
    const allOptions = optionsContainer.querySelectorAll('.option');

    allOptions.forEach(optionBtn => {
        showResult(optionBtn, quiz, document.getElementById('quiz-feedback'));
    });
}

function showResult(optionBtn, quiz, feedbackEl) {
    const optionText = optionBtn.textContent;
    optionBtn.classList.add('disabled'); // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”

    if (optionText === quiz.correctAnswer) {
        optionBtn.classList.add('correct');
    } else {
        optionBtn.classList.add('incorrect');
    }
    
    feedbackEl.textContent = quiz.explanation;
    feedbackEl.style.display = 'block';
}


// í€´ì¦ˆ ê¸°ëŠ¥ ì‹¤í–‰
displayDailyQuiz();


storyImageInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            imagePreview.src = e.target.result;
            imagePreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    } else {
        imagePreview.src = '';
        imagePreview.style.display = 'none';
    }
});

storyForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    if (!currentUser) {
        alert("ë¡œê·¸ì¸ í›„ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
    }
    const content = storyContent.value.trim();
    if (!content) return;

    submitBtn.disabled = true;
    submitBtn.classList.add('loading');
    submitBtn.textContent = 'ì˜¬ë¦¬ëŠ” ì¤‘...';

    // 1. ì´ë¯¸ì§€ íŒŒì¼ ì²´í¬
    const file = storyImageInput.files[0];
    let imageUrl = "";

    try {
        // 2. ì´ë¯¸ì§€ê°€ ì²¨ë¶€ëìœ¼ë©´ Storageì— ì—…ë¡œë“œ
        if (file) {
            const storageRef = ref(storage, `stories/${currentUser.uid}_${Date.now()}_${file.name}`);
            const snapshot = await uploadBytes(storageRef, file);
            imageUrl = await getDownloadURL(snapshot.ref);
        }
        // 3. Firestoreì— ì €ì¥ (imageUrl í¬í•¨)
        await addDoc(collection(db, "stories"), {
            content,
            author: currentUserName,
            uid: currentUser.uid,
            createdAt: serverTimestamp(),
            likesCount: 0,
            likes: [],
            comments: [],
            imageUrl: imageUrl // ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
        });

        modalWrapper.classList.remove('open');
        // ì´ˆê¸°í™”
        storyImageInput.value = '';
        imagePreview.src = '';
        imagePreview.style.display = 'none';

        // â–¼ ì´ í•œ ì¤„ì„ ì¶”ê°€í•˜ì—¬ í”¼ë“œë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.
        loadStories(); 
    } catch (err) {
        alert("ê¸€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + err.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('loading');
        submitBtn.textContent = 'ì˜¬ë¦¬ê¸°';
    }
});

// ====== Modal & Form Logic ======

// ëª¨ë‹¬ì„ ë‹«ëŠ” ê³µí†µ í•¨ìˆ˜ë¥¼ ë§Œë“­ë‹ˆë‹¤.
function closeModal() {
    modalWrapper.classList.remove('open');
    storyForm.reset();
    imagePreview.src = '';
    imagePreview.style.display = 'none';
    charCounter.textContent = "0 / 2000";
}

openBtn.addEventListener('click', () => {
    if (!currentUser) {
        document.querySelector('.cta-button').click();
        return;
    }
    // storyForm.reset() ë“±ì€ closeModal í•¨ìˆ˜ê°€ ì²˜ë¦¬í•˜ë¯€ë¡œ ì—¬ê¸°ì„  ì œê±°
    modalWrapper.classList.add('open');
    setTimeout(() => storyContent.focus(), 250);
});

// ê¸°ì¡´ ë¦¬ìŠ¤ë„ˆë“¤ì„ closeModal í•¨ìˆ˜ í˜¸ì¶œë¡œ ë³€ê²½
closeBtn.addEventListener('click', closeModal);
modalWrapper.addEventListener('click', (e) => {
    if (e.target === modalWrapper) {
        closeModal();
    }
});

storyContent.addEventListener('input', () => {
    charCounter.textContent = `${storyContent.value.length} / 2000`;
});


// ====== Event Delegation for Likes and Comments ======
feed.addEventListener('click', async (e) => {
    // --- Like Button Click ---
    const likeBtn = e.target.closest('.like-btn');
    if (likeBtn) {
        if (!currentUser) {
            document.querySelector('.cta-button').click();
            return;
        }
        const card = likeBtn.closest('.post-card');
        const storyId = card.dataset.postId;
        const storyRef = doc(db, "stories", storyId);
        const likeCountSpan = likeBtn.querySelector('.like-count');
        const currentCount = parseInt(likeCountSpan.textContent);

        // UIë¥¼ ë¨¼ì € ì—…ë°ì´íŠ¸í•˜ê³  DBì— ìš”ì²­ì„ ë³´ë‚¼ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤ (ë‚™ê´€ì  ì—…ë°ì´íŠ¸).
        likeBtn.classList.toggle('liked'); 

        if (likeBtn.classList.contains('liked')) {
            // UI ì—…ë°ì´íŠ¸
            likeCountSpan.textContent = currentCount + 1;
            // DB ì—…ë°ì´íŠ¸
            await updateDoc(storyRef, {
                likes: arrayUnion(currentUser.uid),
                likesCount: increment(1)
            });
        } else {
            // UI ì—…ë°ì´íŠ¸
            likeCountSpan.textContent = currentCount - 1;
            // DB ì—…ë°ì´íŠ¸
            await updateDoc(storyRef, {
                likes: arrayRemove(currentUser.uid),
                likesCount: increment(-1)
            });
        }
    }
    
    // --- Comment Button Click (to focus textarea) ---
    const commentBtn = e.target.closest('.comment-btn');
    if (commentBtn) {
        const card = commentBtn.closest('.post-card');
        card.querySelector('.comment-form textarea').focus();
    }
});
    </script>
</body>
</html>