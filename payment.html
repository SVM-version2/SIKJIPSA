<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오후의 식물 | 식물 이름 찾기와 식집사 기능</title>
    <meta name="description" content="식물 이름 찾기, 병해충 진단, 무제한 등록까지! 식집사를 위한 Pro 구독">

    <meta name="keywords" content="식물, 테라리움, 화분, 미니식물, 식물 추천, 식물상담, 식집사, 플랜테리어">

        <!--메타 픽셀 코드-->
    <!-- Meta Pixel Code -->
<script>
  !function(f,b,e,v,n,t,s)
  {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
  n.callMethod.apply(n,arguments):n.queue.push(arguments)};
  if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
  n.queue=[];t=b.createElement(e);t.async=!0;
  t.src=v;s=b.getElementsByTagName(e)[0];
  s.parentNode.insertBefore(t,s)}(window, document,'script',
  'https://connect.facebook.net/en_US/fbevents.js');
   fbq('init', '1306603984306825'); 
   fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
  src="https://www.facebook.com/tr?id=1306603984306825&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

    <!-- OG 메타태그 (SNS 공유용) -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="오후의 식물 | 식물 이름 찾기와 식집사 기능">
    <meta property="og:description" content="식물 이름 찾기, 병해충 진단, 무제한 등록까지! 식집사를 위한 Pro 구독">
    <meta property="og:image" content="https://plantnoon.com/logo.png">
    <meta property="og:url" content="https://plantnoon.com/payment.html">

    <!-- 트위터 카드 -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="오후의 식물 | 식물 이름 찾기와 식집사 기능">
    <meta name="twitter:description" content="식물 이름 찾기, 병해충 진단, 무제한 등록까지! 식집사를 위한 Pro 구독">
    <meta name="twitter:image" content="https://plantnoon.com/logo.png">

    <link rel="icon" href="logo.png?v=2" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="navigation.css">
    
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyC7mA9xLOFb98i5hKNWjKW_fORWNHvPx2s",
  authDomain: "sik-jip-sa.firebaseapp.com",
  projectId: "sik-jip-sa",
  storageBucket: "sik-jip-sa.firebasestorage.app",
  messagingSenderId: "401707534850",
  appId: "1:401707534850:web:e15b2f67e2d4484a07351b",
  measurementId: "G-HX50P6C0NT"
};
 // Firebase 앱 초기화
 if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
 }
</script>

    <!-- PortOne (iamport) JavaScript SDK -->
<script src="https://cdn.iamport.kr/v1/iamport.js"></script>
<script>
  // SDK가 로드된 뒤에 확실히 init
  window.addEventListener('DOMContentLoaded', function () {
    if (!window.IMP) {
      alert('결제 모듈 로드에 실패했습니다. 새로고침 후 다시 시도해주세요.');
      return;
    }
    window.IMP.init('imp11786186'); 
  });
</script>

    <style>

        /* 기본 변수 설정 */




/* 구독 페이지 전용 스타일 */
.payment-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.page-header {
    text-align: center;
    margin-bottom: 40px;
}

.page-header h1 {
    font-family: var(--font-serif);
    font-size: 2.8rem;
    color: var(--primary-green);
    margin-bottom: 10px;
}

.page-header p {
    font-size: 1.1rem;
    color: var(--text-light);
    max-width: 600px;
}

.plans-wrapper {
    display: flex;
    justify-content: center;
    gap: 30px;
    width: 100%;
    flex-wrap: wrap;
}

.plan-card {
    background-color: #ffffff;
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 30px;
    width: 100%;
    max-width: 380px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    display: flex;
    flex-direction: column;
    transition: transform 0.3s, box-shadow 0.3s;
}

.plan-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
}

.plan-card.pro {
    border-top: 5px solid var(--primary-green);
}

.plan-header {
    text-align: center;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 20px;
    margin-bottom: 20px;
}

.plan-header h2 {
    font-family: var(--font-serif);
    font-size: 2rem;
    color: var(--text-dark);
    margin: 0 0 5px 0;
}

.plan-header .price {
     font-size: 1.5rem;
     font-weight: 700;
     color: var(--primary-green);
}

 .plan-header .price span {
     font-size: 1rem;
     font-weight: 400;
     color: var(--text-light);
}

.plan-features {
    list-style: none;
    padding: 0;
    margin: 0 0 30px 0;
    flex-grow: 1; /* 버튼을 카드 하단에 고정시키는 역할 */
}

.plan-features li {
    display: flex;
    align-items: flex-start;
    margin-bottom: 20px;
    color: var(--text-light);
    line-height: 1.6;
}

.plan-features li::before {
    content: '✓';
    color: var(--primary-green);
    font-weight: 700;
    margin-right: 12px;
    font-size: 1.2rem;
}

.feature-title {
    font-weight: 700;
    color: var(--text-dark);
    display: block;
}

.plan-button {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: background-color 0.3s, color 0.3s;
    text-align: center;
    text-decoration: none;
    box-sizing: border-box;
}

.free .plan-button {
    background-color: #fff;
    color: var(--primary-green);
    border: 2px solid var(--primary-green);
}

.free .plan-button:hover {
    background-color: var(--primary-green);
    color: #fff;
}

.free .plan-button.disabled,
.free .plan-button[aria-disabled="true"] {
    background: #ecf5ef !important;
    color: var(--primary-green) !important;
    border: 2px solid var(--primary-green) !important;
    cursor: default !important;
    font-weight: 800;
    pointer-events: none !important;
    box-shadow: none !important;
}

.pro .plan-button {
    background-color: var(--primary-green);
    color: #fff;
}

.pro .plan-button:hover {
    background-color: #3e5a3e; /* 더 진한 녹색 */
}

/* 반응형 디자인 */
@media (max-width: 768px) {
    .plans-wrapper {
        flex-direction: column;
        align-items: center;
    }
    .page-header h1 {
        font-size: 2.2rem;
    }
}

        /* 푸터 전용 스타일 */
    .main-footer {
        background-color: var(--bg-cream);
        color: var(--text-dark);
        padding: 50px 20px 20px;
        border-top: 1px solid #e9e6e6;
        font-size: 0.95rem;
    }
    .footer-container {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 40px;
        padding-bottom: 40px;
        border-bottom: 1px solid #e0dcd1;
    }
    .footer-about {
        max-width: 300px;
    }
    .footer-about .logo {
        font-family: var(--font-serif);
        font-size: 1.8rem;
        font-weight: 600;
        color: var(--primary-green);
        text-decoration: none;
        margin-bottom: 12px;
        display: inline-block;
    }
    .footer-about p {
        line-height: 1.7;
        color: #7a7a5c;
        margin-bottom: 20px;
    }
    .footer-social a {
        color: #7a7a5c;
        text-decoration: none;
        margin-right: 18px;
        transition: color 0.2s;
    }
    .footer-social a:hover {
        color: var(--primary-green);
    }
    .footer-links-group {
        display: flex;
        gap: 50px;
    }
    .footer-links h4 {
        font-family: var(--font-serif);
        color: var(--text-dark);
        font-size: 1.2rem;
        margin-bottom: 15px;
    }
    .footer-links ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    .footer-links li {
        margin-bottom: 10px;
    }
    .footer-links a {
        color: #7a7a5c;
        text-decoration: none;
        transition: color 0.2s;
    }
    .footer-links a:hover {
        color: var(--primary-green);
        text-decoration: underline;
    }
    .footer-bottom {
        text-align: center;
        padding-top: 20px;
        font-size: 0.85rem;
        color: #b2a97e;
    }
    /* 푸터 하단 및 사업자 정보 스타일 */
.business-info {
    font-size: 0.8rem;
    color: #908976; /* 기존보다 약간 더 잘 보이는 색상 */
    line-height: 1.7;
    margin-bottom: 20px;
}

.business-info strong {
    color: #7a7a5c;
    font-weight: 500;
}

.business-info p {
    margin: 0;
}

/* 기존 저작권 텍스트의 클래스명을 추가하여 스타일을 명확히 함 */
.copyright-text {
    font-size: 0.85rem;
    color: #b2a97e;
    margin: 0;
}

    @media (max-width: 768px) {
        .footer-container {
            flex-direction: column;
            text-align: center;
        }
        .footer-about {
            max-width: 100%;
        }
        .footer-social {
            margin-bottom: 20px;
        }
        .footer-links-group {
            width: 100%;
            justify-content: space-around;
            text-align: center;
        }
            .business-info {
        font-size: 0.75rem; /* 모바일에서 글자 크기 살짝 줄임 */
    }
    }

    /* 이 코드를 <style> 태그 안에 추가하세요 */

/* 'Free'와 'Pro' 플랜 카드를 감싸는 부모 요소 */
.plans-wrapper {
    display: flex;         /* 플렉스박스 레이아웃으로 자식 요소들을 가로로 배열 */
    justify-content: center; /* 중앙 정렬 */
    align-items: stretch;  /* 높이가 다른 경우, 가장 긴 요소에 맞춰 늘림 */
    flex-wrap: wrap;       /* 화면이 좁아지면 자동으로 줄바꿈 */
    gap: 30px;             /* 카드 사이의 간격 */
    width: 100%;
}

/* 개별 플랜 카드 스타일 조정 */
.plan-card {
    width: 320px; /* 고정 너비 지정 */
    flex-shrink: 0; /* 화면이 줄어들 때 카드의 크기가 줄어들지 않도록 설정 */
}

/* (최대 3개)와 같은 세부 설명 텍스트 스타일 */
/* 이 코드로 교체하거나 기존 코드에서 display와 margin-top을 수정하세요. */

/* (최대 3개)와 같은 세부 설명 텍스트 스타일 */
.feature-detail {
    font-size: 0.9rem; /* 기본 텍스트보다 약간 작은 글자 크기 */
    color: #999;      /* 눈에 덜 띄는 회색 계열 색상 */
    /* display: block 속성을 제거하여 줄바꿈을 방지합니다. */
}
/* 이 코드를 <style> 태그 안에 추가하세요 */

.feature-description {
    color: #7a7a5c; /* var(--text-light)와 동일한 색상입니다. */
    font-size: 0.95rem;
    display: block; /* 제목과 설명이 다른 줄에 표시되도록 합니다. */
    margin-top: 2px;
}

    /* 애니메이션 정의 */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }


/* [2. 메인 헤드라인(h1) 색상 변경]
  가장 큰 제목의 글자색을 밝게 변경합니다.
*/
.page-header-animated h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.8rem;
    color: #FDFBF8; /* 밝은 아이보리색 */
    margin-bottom: 15px;
    line-height: 1.4;
    margin-top: 6rem;
    /* 애니메이션 실행 */
    animation: fadeInUp 0.8s ease-out forwards;
    opacity: 0; /* 시작 전 숨김 */
}

/* 설명(p) 스타일 및 애니메이션 적용 */
.page-header-animated p {
    font-size: 1.1rem;
    color: #FDFBF8; /* 밝은 아이보리색 */
    max-width: 650px;
    margin: 0 auto;
    line-height: 1.7;
    
    /* h1보다 0.3초 늦게 애니메이션 실행 */
    animation: fadeInUp 0.8s ease-out 0.3s forwards;
    opacity: 0; /* 시작 전 숨김 */
}

/* 설명 문구 안의 단어 강조 스타일 */
.page-header-animated .highlight {
    color: #B4D9B5; /* 배경과 어울리는 밝은 민트색 */
    font-weight: 700;
}

/* 모바일 반응형 스타일 */
@media (max-width: 768px) {
  .page-header-animated h1 {
      font-size: 2.2rem;
  }
  .page-header-animated p {
      font-size: 1rem;
  }
}
    </style>
</head>
<body>

    <!-- 헤더는 기존 코드를 그대로 사용합니다. -->
    <header id="main-header">
        <a href="index.html" class="logo">
            <img src="logo.png" alt="오후의식물 로고">
            <span>오후의 식물</span>
        </a>
        <nav>
            <a href="index.html">홈</a>
            <a href="story.html">초록 이야기</a>
            <a href="myPlant.html">나의 식물</a>
            <a href="findPlant.html">식물 상담소</a>
            <a href="payment.html">구독하기</a>
            <a href="#" class="cta-button">Login</a>
        </nav>
    </header>


      <main class="payment-container">
        <div class="page-header page-header-animated">
        <h1>당신의 공간이, 살아있는 정원이 됩니다</h1>
        <p>
            식물 하나가 주는 위로와 행복의 가치를 아시나요? 단순한 관리를 넘어,<br>
            식물과 교감하며 <span class="highlight">나만의 작은 숲</span>을 가꾸어보세요.
        </p>
    </div>

        <div class="plans-wrapper">
<div class="plan-card free">
    <div class="plan-header">
        <h2>Free</h2>
        <div class="price">₩0 <span>/ 평생</span></div>
    </div>
    <ul class="plan-features">
        <li>
            <div>
                <span class="feature-title">제한된 식물 등록</span>
                <span class="feature-description">기본적인 식물 관리를 시작해보세요.</span>
                <span class="feature-detail">(최대 3개)</span>
            </div>
        </li>
        <li>
            <div>
                <span class="feature-title">제한된 기능 이용</span>
                <span class="feature-description">핵심적인 식물 관리 기능을 체험할 수 있습니다.</span>
            </div>
        </li>
    </ul>
     <a href="#" id="free-plan-button" class="plan-button disabled" tabindex="-1" aria-disabled="true">현재 플랜 유지하기</a>
</div>

<div class="plan-card pro">
    <div class="plan-header">
        <h2>Pro</h2>
        <div class="price">₩2,900 <span>/ 월 정기결제</span></div>
    </div>
    <ul class="plan-features">
        <li>
            <div>
                <span class="feature-title">무제한 식물 등록</span>
                <span class="feature-description">반려식물을 제한 없이 등록하고, 더 자유롭게 관리해보세요.</span>
            </div>
        </li>
        <li>
            <div>
                <span class="feature-title">무제한 병충해 진단</span>
                <span class="feature-description">사진만 올리면 병해충 진단과 해결책을 바로 알려드립니다.</span>
            </div>
        </li>
        <li>
            <div>
                <span class="feature-title">식물 이름 무제한 찾기</span>
                <span class="feature-description">모르는 식물도 사진으로 한 번에! 이름과 기본 정보를 바로 확인하세요.</span>
            </div>
        </li>
    </ul>
  <a href="#" id="pro-plan-button" class="plan-button">Pro로 업그레이드</a>

</div>
        </div>
    </main>

<div id="payment-modal" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:16px; max-width:380px; width:90%; margin:auto; box-shadow:0 10px 40px rgba(0,0,0,0.12); position:relative; text-align:center; padding: 25px;">
        
        <button id="close-payment-modal" style="position:absolute; top:12px; right:15px; font-size:2rem; color:#aaa; background:none; border:none; cursor:pointer; line-height:1;">&times;</button>
        
        <div style="margin-bottom:20px;">
            <h3 style="font-family: 'Playfair Display', serif; font-size:1.8rem; margin:10px 0 8px 0; color:#3a593b;">Upgrade to Pro</h3>
            <p style="font-size:1rem; color:#777;">결제 전, Pro 플랜의 혜택을 다시 확인하세요.</p>
        </div>

        <div style="background-color:#f8f7f4; border-radius:10px; padding:18px; margin-bottom:20px; text-align:left;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <span style="font-weight:700; font-size:1.1rem; color:#333;">Pro Plan</span>
                <span style="font-family: 'Lato', sans-serif; font-weight:700; font-size:1.3rem; color:#3a593b;">₩2,900<span style="font-weight:400; font-size:1rem;">/월 정기결제</span></span>
            </div>
            <ul style="list-style:none; padding:0; margin:0; font-size:0.95rem; color:#555;">
                <li style="margin-bottom:8px; display:flex; align-items:center;">
                    <span style="color:#3a593b; margin-right:8px;">✓</span> 무제한 식물 등록 및 관리
                </li>
                <li style="margin-bottom:8px; display:flex; align-items:center;">
                    <span style="color:#3a593b; margin-right:8px;">✓</span> 무제한 병충해 진단
                </li>
                <li style="display:flex; align-items:center;">
                    <span style="color:#3a593b; margin-right:8px;">✓</span> 식물 이름 무제한 찾기
                </li>
            </ul>
        </div>
        
        <a href="https://your.kakaopay.payment.link" target="_blank" style="display:flex; align-items:center; justify-content:center; width:90%; background:#fee500; color:#191919; font-weight:700; border-radius:8px; padding:15px; font-size:1.1rem; text-decoration:none; box-shadow:0 2px 8px rgba(0,0,0,0.06); margin-bottom:12px;">
            카카오페이로 결제하기
        </a>
        
        <div style="font-size:0.85rem; color:#999; line-height:1.5;">
            * 결제 완료 후 Pro 플랜이 즉시 적용됩니다.<br>
            * 구독은 언제든 <a href="refund.html" target="_blank" style="color:#999;">환불 정책</a>에 따라 관리할 수 있습니다.
        </div>
    </div>
</div>

         <div id="modal-wrapper" class="modal-wrapper">
        <div class="modal">
            <div class="modal-left"></div>
            <div class="modal-right">
                <button class="close-button">&times;</button>
                <!-- Login Form -->
                <div id="login-form" class="form-container">
                    <div class="form-header">
                        <a href="index.html" class="logo">오후의 식물</a>
                        <h2>Welcome Back</h2>
                    </div>
                    <form>
                        <div class="input-group">
                            <label for="login-email">Email</label>
                            <input type="email" id="login-email" required>
                        </div>
                        <div class="input-group">
                            <label for="login-password">Password</label>
                            <input type="password" id="login-password" required>
                        </div>
                        <button type="submit" class="cta-button">Login</button>
                    </form>
                    <p class="form-switcher">
                        Don't have an account? <a href="#" id="show-signup">Sign Up</a>
                    </p>
                </div>

                <!-- Signup Form -->
                <div id="signup-form" class="form-container" style="display: none;">
                    <div class="form-header">
                        <a href="index.html" class="logo">오후의 식물</a>
                        <h2>Create Account</h2>
                    </div>
                    <form>
                        <div class="input-group">
                            <label for="signup-name">Name</label>
                            <input type="text" id="signup-name" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-email">Email</label>
                            <input type="email" id="signup-email" required>
                        </div>
                        <div class="input-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" required>
                        </div>
                        <div class="agreement-group">
    <div class="checkbox-group">
        <input type="checkbox" id="signup-terms" name="terms" required>
        <label for="signup-terms">
            [필수] <a href="terms.html" target="_blank">이용약관</a>에 동의합니다.
        </label>
    </div>
    <div class="checkbox-group">
        <input type="checkbox" id="signup-privacy" name="privacy" required>
        <label for="signup-privacy">
            [필수] <a href="privacy.html" target="_blank">개인정보처리방침</a>에 동의합니다.
        </label>
    </div>
</div>

<button type="submit" class="cta-button">Create Account</button>
                    </form>
                    <p class="form-switcher">
                        Already have an account? <a href="#" id="show-login">Login</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <footer class="main-footer">
    <div class="footer-container">
        <div class="footer-about">
            <a href="index.html" class="logo">오후의 식물</a>
            <p>식물과 함께하는 모든 순간이 더 행복하고 의미 있도록, 오후의 식물이 당신의 초록빛 여정에 함께합니다.</p>
            <div class="footer-social">
                <a href="https://www.instagram.com/plantnoon/" target="_blank">Instagram</a>
                <a href="https://blog.naver.com/happy_care_service/223955159263" target="_blank">Blog</a>
                <a href="https://open.kakao.com/o/gJLPjuKh" target="_blank">Open Chat</a>
            </div>
        </div>
        <div class="footer-links-group">
            <div class="footer-links">
                <h4>Policy</h4>
                <ul>
                    <li><a href="terms.html">이용약관</a></li>
                    <li><a href="privacy.html">개인정보처리방침</a></li>
                    <li><a href="refund.html">환불정책</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="footer-bottom">
        <div class="business-info">
            <p>
                상호명: 고하이어(GoHigher) | 대표자명: 박해진 | 사업자등록번호: 407-09-54622<br>
                주소: 대구광역시 북구 동천로 155, 101동 1202호 | 대표전화번호: 070-8080-1675
            </p>
        </div>
        <p>&copy; 2025 Plantnoon. All Rights Reserved.</p>
    </div>
</footer>

<nav id="bottom-nav">
  <a href="index.html" class="nav-item">
    <span class="nav-icon">🏠</span>
  </a>
  <a href="story.html" class="nav-item">
    <span class="nav-icon">🌱</span>
  </a>
  <a href="myPlant.html" class="nav-item">
    <span class="nav-icon">🪴</span>
  </a>
  <a href="findPlant.html" class="nav-item">
    <span class="nav-icon">💬</span>
  </a>
    <a href="payment.html" class="nav-item">
    <span class="nav-icon">⭐</span>
  </a>
</nav>



<div id="user-status-modal" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); align-items:center; justify-content:center;">
    <div style="background:#fff; border-radius:16px; max-width:380px; width:90%; margin:auto; box-shadow:0 10px 40px rgba(0,0,0,0.12); position:relative; text-align:center; padding: 30px;">
        
        <button id="close-status-modal" style="position:absolute; top:12px; right:15px; font-size:2rem; color:#aaa; background:none; border:none; cursor:pointer; line-height:1;">&times;</button>
        
        <div style="margin-bottom:20px;">
            <h3 style="font-family: 'Playfair Display', serif; font-size:1.8rem; margin:10px 0 8px 0; color:#3a593b;">내 구독 정보</h3>
            <p style="font-size:1rem; color:#777;">현재 구독 중인 플랜의 정보입니다.</p>
        </div>

        <div id="subscription-info" style="background-color:#f8f7f4; border-radius:10px; padding:25px; margin-bottom:25px; text-align:left;">
            <p style="margin:0; text-align:center;">구독 정보를 불러오는 중...</p>
        </div>
        
        <div id="modal-actions" style="display: flex; gap: 10px; width: 100%;">
            <button id="cancel-subscription-button" style="flex: 1; padding: 14px; border: 1px solid #d32f2f; background-color: #fff; color: #d32f2f; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer; display: none;">
                구독 취소
            </button>
            <button id="logout-button" style="flex: 1; padding: 14px; border: none; background-color: #e0e0e0; color: #333; border-radius: 8px; font-size: 1rem; font-weight: 700; cursor: pointer;">
                로그아웃
            </button>
        </div>
    </div>
</div>


    <script type="module" src="navigation.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const proPlanButton = document.getElementById('pro-plan-button');

    // Firebase 인증 상태 변경을 감지하는 리스너
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            // 사용자가 로그인한 경우
            console.log(user.uid, "사용자 로그인 상태");
            checkSubscriptionStatus(user.uid);
        } else {
            // 사용자가 로그아웃한 경우
            console.log("사용자 로그아웃 상태");
            updateUI(false); // 로그아웃 시 기본 UI (업그레이드 버튼 활성화)
        }
    });

    // Firestore에서 구독 상태 확인하는 함수
    function checkSubscriptionStatus(uid) {
        const db = firebase.firestore();
        const userDocRef = db.collection('users').doc(uid);

        userDocRef.get().then((doc) => {
            if (doc.exists) {
                const isPro = doc.data().proPlan === true;
                updateUI(isPro);
            } else {
                console.log("사용자 문서를 찾을 수 없습니다.");
                updateUI(false);
            }
        }).catch((error) => {
            console.error("사용자 정보 조회 중 오류 발생: ", error);
            updateUI(false);
        });
    }

    // 구독 상태에 따라 UI를 업데이트하는 함수
    function updateUI(isPro) {
        // 각 플랜의 버튼 요소를 가져옵니다.
        const freeButton = document.getElementById('free-plan-button');
        const proButton = document.getElementById('pro-plan-button');
        
    if (isPro) {
        // --- Pro 구독자인 경우 ---
        
        // Free 버튼: '현재 플랜 유지하기'에서 'Free 플랜'으로 텍스트 변경하고, 비활성화 클래스 제거
        freeButton.textContent = "Free 플랜"; // 또는 '다운그레이드' 등
        freeButton.classList.remove('disabled');
        freeButton.style.pointerEvents = 'auto'; 
        freeButton.removeAttribute('aria-disabled');
        freeButton.setAttribute('href', '#'); // 다운그레이드 페이지로 연결 가능

        // Pro 버튼: '현재 구독 중'으로 텍스트 변경하고 비활성화
        proButton.textContent = "현재 구독 중인 플랜";
        proButton.classList.add('disabled');
        proButton.style.pointerEvents = 'none';
        proButton.setAttribute('aria-disabled', 'true');
        proButton.setAttribute('href', '#');

    } else {
        // --- Free 이용자 또는 비로그인 상태인 경우 ---

        // Free 버튼: '현재 구독 중'으로 텍스트 변경하고 비활성화
        freeButton.textContent = "현재 구독 중인 플랜";
        freeButton.classList.add('disabled');
        freeButton.style.pointerEvents = 'none';
        freeButton.setAttribute('aria-disabled', 'true');
        
        // Pro 버튼: '업그레이드' 텍스트를 보여주고 활성화
        proButton.textContent = "Pro로 업그레이드";
        proButton.classList.remove('disabled');
        proButton.style.pointerEvents = 'auto';
        proButton.removeAttribute('aria-disabled');
    }
}
    
    // --- 결제 로직 ---
proPlanButton.addEventListener('click', function (e) {
    e.preventDefault();
    

    const user = firebase.auth().currentUser;
    if (!user) {
        alert("로그인이 필요합니다.");
        return;
    }

          // 🔔 퍼널 시작 신호(선택 권장) 이게 메타임 **********************************************
  if (window.fbq) {
    fbq('track', 'InitiateCheckout', {
      content_name: 'PlantNoon Pro',
      value: 2900,
      currency: 'KRW'
    });
  }
  
    if (proPlanButton.classList.contains('disabled')) {
        return;
    }

    const userUid = user.uid;
    const merchantUid = "pro_" + new Date().getTime(); // 고유한 주문번호 생성

    window.IMP.request_pay({
        pg: "kakaopay.CA61377641",
        pay_method: "card",
        merchant_uid: merchantUid, // ✅ 다시 추가 (필수)
        // 고객의 고유 ID를 customer_uid로 전달하여 빌링키 발급을 요청합니다.
        customer_uid: userUid, 
        name: "오후의 식물 Pro 구독",   // ✅ 다시 추가 (필수)
        amount: 2900,               // 실제 서비스 금액으로 변경
        buyer_email: user.email,    // ✅ 다시 추가 (로그인한 사용자 이메일)
        buyer_name: user.displayName || "구매자", // ✅ 다시 추가 (로그인한 사용자 이름)
        buyer_tel: "010-0000-0000",  // ✅ 다시 추가 (필요시 사용자 정보에서 가져옴)
        m_redirect_url: "https://plantnoon.com/payment.html" 
    }, function (rsp) {
        if (rsp.success) {
            fetch("/api/payments/verify", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    imp_uid: rsp.imp_uid,
                    merchant_uid: merchantUid, // 생성한 주문번호를 그대로 전달
                    user_uid: userUid
                })
                })
                .then(res => res.json())
.then(data => {
  if (data.status === 'success') {
    // ✅ 서버 검증 성공 → 실제 구독 완료 신호 **********이것도 메타임****************88
    if (window.fbq) {
      fbq('track', 'Subscribe', {
        value: 2900,
        currency: 'KRW',
        plan: 'monthly',
   subscription_id: merchantUid,  // ← 주문/구독 식별자
    user_uid: userUid              // ← 내부 사용자 식별자(커스텀)
  });
    }

    alert("결제 및 Pro 플랜 적용이 완료되었습니다!");
    updateUI(true); // 결제 성공 후 UI 즉시 업데이트
  } else {
    alert("서버 검증 실패: " + data.message);
  }
});
            } else {
                alert("결제 실패: " + rsp.error_msg);
            }
        });
    });
});






// ==========================================================
// 📍 2단계: ~~집사님 버튼에 대한 모달 띄우는 거임. 네비게이션.js에 넣으니깐 오류 나서 따로 넣음
// ==========================================================

document.addEventListener('DOMContentLoaded', function () {
    const db = firebase.firestore();
    const auth = firebase.auth();

    // 네비게이션의 로그인/내 정보 버튼
    const userStatusButton = document.querySelector('header nav a.cta-button'); 

    // 모달 관련 요소들
    const userStatusModal = document.getElementById('user-status-modal');
    const closeStatusModal = document.getElementById('close-status-modal');
    const subscriptionInfoDiv = document.getElementById('subscription-info');
    const logoutButton = document.getElementById('logout-button');
    const cancelSubscriptionButton = document.getElementById('cancel-subscription-button');

    // 인증 상태 변경 감지
    auth.onAuthStateChanged(user => {
        if (user) {
            // --- 로그인 상태일 때 ---

            // ✨ (추가) 로그인 시, 만료일이 지난 '취소 예약' 건을 찾아 실제 플랜을 강등시킵니다.
            const userDocRef = db.collection('users').doc(user.uid);
            userDocRef.get().then(doc => {
                if (doc.exists) {
                    const data = doc.data();
                    const now = new Date();
                    
                    // '취소 예약' 상태이고, 구독 만료일이 이미 지났는지 확인
                    if (data.cancelAtPeriodEnd === true && data.subscriptionExpiresAt.toDate() < now) {
                        // 만료되었으므로 Free 플랜으로 최종 변경
                        userDocRef.update({
                            proPlan: false,
                            cancelAtPeriodEnd: false, // 플래그 초기화
                            subscriptionExpiresAt: firebase.firestore.FieldValue.delete()
                        }).then(() => {
                            console.log("Subscription has expired. User plan downgraded to Free.");
                        });
                    }
                }
            });
            
            userStatusButton.addEventListener('click', e => {
                e.preventDefault();
                
                // Firestore에서 최신 사용자 구독 정보 가져오기
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        const data = doc.data();

                        if (data.proPlan) { // 1. Pro 플랜 구독자인 경우
                            const expiresAtDate = data.subscriptionExpiresAt.toDate();
                            const formattedDate = `${expiresAtDate.getFullYear()}년 ${expiresAtDate.getMonth() + 1}월 ${expiresAtDate.getDate()}일`;

                            if (data.cancelAtPeriodEnd === true) {
                                // 1a. Pro 플랜 + '취소 예약' 상태인 경우
                                subscriptionInfoDiv.innerHTML = `
                                    <div style="font-size: 1rem; color: #555;">
                                        <p style="margin:0 0 15px 0;"><strong>플랜:</strong> <span style="color:#d32f2f; font-weight:bold;">Pro (취소 예약됨)</span></p>
                                        <p style="margin:0;"><strong>플랜 만료일:</strong> <span style="color:#3a593b; font-weight:bold;">${formattedDate}</span></p>
                                    </div>
                                `;
                                // ✨ (수정) 버튼 텍스트를 바꾸고, 재활성화 기능은 추후 구현 필요
                                cancelSubscriptionButton.textContent = "구독 재활성화"; 
                                cancelSubscriptionButton.style.display = 'block';

                            } else {
                                // 1b. 순수 Pro 플랜 상태인 경우
                                subscriptionInfoDiv.innerHTML = `
                                    <div style="font-size: 1rem; color: #555;">
                                        <p style="margin:0 0 15px 0;"><strong>플랜:</strong> <span style="color:#3a593b; font-weight:bold;">Pro</span></p>
                                        <p style="margin:0;"><strong>다음 결제 예정일:</strong> <span style="color:#3a593b; font-weight:bold;">${formattedDate}</span></p>
                                    </div>
                                `;
                                cancelSubscriptionButton.textContent = "구독 취소";
                                cancelSubscriptionButton.style.display = 'block';
                            }
                        } else {
                            // 2. 무료 이용자인 경우
                            subscriptionInfoDiv.innerHTML = '<p style="margin:0;"><strong>플랜:</strong> Free</p>';
                            cancelSubscriptionButton.style.display = 'none';
                        }
                    }
                }).catch(error => {
                    console.error("사용자 정보 조회 실패:", error);
                    subscriptionInfoDiv.innerHTML = '<p>정보를 불러오는 데 실패했습니다.</p>';
                });

                userStatusModal.style.display = 'flex'; // 모달 열기
            });

        } else {
            // --- 로그아웃 상태일 때 ---
            userStatusButton.textContent = "Login";
        }
    });

    // '내 정보' 모달 닫기
    closeStatusModal.addEventListener('click', () => {
        userStatusModal.style.display = 'none';
    });
    
    // ✨ (수정) 구독 취소 버튼 클릭 이벤트: 이제 '취소 예약' 플래그만 설정합니다.
    cancelSubscriptionButton.addEventListener('click', () => {
        const user = auth.currentUser;
        if (!user) {
            alert("오류: 로그인 상태가 아닙니다.");
            return;
        }

        // 여기에 '구독 재활성화' 로직도 추가할 수 있습니다. (현재는 취소 로직만 구현)
        if (cancelSubscriptionButton.textContent === "구독 재활성화") {
            // 예: db.collection('users').doc(user.uid).update({ cancelAtPeriodEnd: false })...
            alert("구독 재활성화 기능은 현재 준비 중입니다.");
            return;
        }

        if (confirm("다음 결제일부터 구독을 갱신하지 않습니다. 남은 기간 동안 Pro 플랜을 계속 이용할 수 있습니다. 정말 취소하시겠습니까?")) {
            db.collection('users').doc(user.uid).update({
                cancelAtPeriodEnd: true // '취소 예약' 플래그 설정
            })
            .then(() => {
                alert("구독 취소 예약이 완료되었습니다. 현재 플랜은 만료일까지 유지됩니다.");
                window.location.reload(); // UI 갱신을 위해 새로고침
            })
            .catch((error) => {
                console.error("구독 취소 예약 중 오류 발생: ", error);
                alert("처리 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
            });
        }
    });

    // 모달 내 로그아웃 버튼
    logoutButton.addEventListener('click', () => {
        auth.signOut().then(() => {
            alert('로그아웃 되었습니다.');
            window.location.reload();
        });
    });
});
</script>

</body>
</html>
